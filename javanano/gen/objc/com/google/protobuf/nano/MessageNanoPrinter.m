//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/andrefonseca/Documents/PodsFolders/protobuf/javanano/src/main/java/com/google/protobuf/nano/MessageNanoPrinter.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "com/google/protobuf/nano/MessageNano.h"
#include "com/google/protobuf/nano/MessageNanoPrinter.h"
#include "java/lang/Boolean.h"
#include "java/lang/Character.h"
#include "java/lang/IllegalAccessException.h"
#include "java/lang/Integer.h"
#include "java/lang/NoSuchMethodException.h"
#include "java/lang/StringBuffer.h"
#include "java/lang/StringBuilder.h"
#include "java/lang/reflect/Array.h"
#include "java/lang/reflect/Field.h"
#include "java/lang/reflect/InvocationTargetException.h"
#include "java/lang/reflect/Method.h"
#include "java/lang/reflect/Modifier.h"
#include "java/util/Map.h"
#include "java/util/Set.h"

@interface ComGoogleProtobufNanoMessageNanoPrinter ()

- (instancetype)init;

/*!
 @brief Function that will print the given message/field into the StringBuffer.
 Meant to be called recursively.
 @param identifier the identifier to use, or <code>null</code> if this is the root message to
 print.
 @param object the value to print. May in fact be a primitive value or byte array and not a
 message.
 @param indentBuf the indentation each line should begin with.
 @param buf the output buffer.
 */
+ (void)printWithNSString:(NSString *)identifier
                   withId:(id)object
 withJavaLangStringBuffer:(JavaLangStringBuffer *)indentBuf
 withJavaLangStringBuffer:(JavaLangStringBuffer *)buf;

/*!
 @brief Converts an identifier of the format "FieldName" into "field_name".
 */
+ (NSString *)deCamelCaseifyWithNSString:(NSString *)identifier;

/*!
 @brief Shortens and escapes the given string.
 */
+ (NSString *)sanitizeStringWithNSString:(NSString *)str;

/*!
 @brief Escape everything except for low ASCII code points.
 */
+ (NSString *)escapeStringWithNSString:(NSString *)str;

/*!
 @brief Appends a quoted byte array to the provided <code>StringBuffer</code>.
 */
+ (void)appendQuotedBytesWithByteArray:(IOSByteArray *)bytes
              withJavaLangStringBuffer:(JavaLangStringBuffer *)builder;

@end

inline NSString *ComGoogleProtobufNanoMessageNanoPrinter_get_INDENT();
static NSString *ComGoogleProtobufNanoMessageNanoPrinter_INDENT = @"  ";
J2OBJC_STATIC_FIELD_OBJ_FINAL(ComGoogleProtobufNanoMessageNanoPrinter, INDENT, NSString *)

inline jint ComGoogleProtobufNanoMessageNanoPrinter_get_MAX_STRING_LEN();
#define ComGoogleProtobufNanoMessageNanoPrinter_MAX_STRING_LEN 200
J2OBJC_STATIC_FIELD_CONSTANT(ComGoogleProtobufNanoMessageNanoPrinter, MAX_STRING_LEN, jint)

__attribute__((unused)) static void ComGoogleProtobufNanoMessageNanoPrinter_init(ComGoogleProtobufNanoMessageNanoPrinter *self);

__attribute__((unused)) static ComGoogleProtobufNanoMessageNanoPrinter *new_ComGoogleProtobufNanoMessageNanoPrinter_init() NS_RETURNS_RETAINED;

__attribute__((unused)) static ComGoogleProtobufNanoMessageNanoPrinter *create_ComGoogleProtobufNanoMessageNanoPrinter_init();

__attribute__((unused)) static void ComGoogleProtobufNanoMessageNanoPrinter_printWithNSString_withId_withJavaLangStringBuffer_withJavaLangStringBuffer_(NSString *identifier, id object, JavaLangStringBuffer *indentBuf, JavaLangStringBuffer *buf);

__attribute__((unused)) static NSString *ComGoogleProtobufNanoMessageNanoPrinter_deCamelCaseifyWithNSString_(NSString *identifier);

__attribute__((unused)) static NSString *ComGoogleProtobufNanoMessageNanoPrinter_sanitizeStringWithNSString_(NSString *str);

__attribute__((unused)) static NSString *ComGoogleProtobufNanoMessageNanoPrinter_escapeStringWithNSString_(NSString *str);

__attribute__((unused)) static void ComGoogleProtobufNanoMessageNanoPrinter_appendQuotedBytesWithByteArray_withJavaLangStringBuffer_(IOSByteArray *bytes, JavaLangStringBuffer *builder);

@implementation ComGoogleProtobufNanoMessageNanoPrinter

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  ComGoogleProtobufNanoMessageNanoPrinter_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (NSString *)printWithComGoogleProtobufNanoMessageNano:(ComGoogleProtobufNanoMessageNano *)message {
  return ComGoogleProtobufNanoMessageNanoPrinter_printWithComGoogleProtobufNanoMessageNano_(message);
}

+ (void)printWithNSString:(NSString *)identifier
                   withId:(id)object
 withJavaLangStringBuffer:(JavaLangStringBuffer *)indentBuf
 withJavaLangStringBuffer:(JavaLangStringBuffer *)buf {
  ComGoogleProtobufNanoMessageNanoPrinter_printWithNSString_withId_withJavaLangStringBuffer_withJavaLangStringBuffer_(identifier, object, indentBuf, buf);
}

+ (NSString *)deCamelCaseifyWithNSString:(NSString *)identifier {
  return ComGoogleProtobufNanoMessageNanoPrinter_deCamelCaseifyWithNSString_(identifier);
}

+ (NSString *)sanitizeStringWithNSString:(NSString *)str {
  return ComGoogleProtobufNanoMessageNanoPrinter_sanitizeStringWithNSString_(str);
}

+ (NSString *)escapeStringWithNSString:(NSString *)str {
  return ComGoogleProtobufNanoMessageNanoPrinter_escapeStringWithNSString_(str);
}

+ (void)appendQuotedBytesWithByteArray:(IOSByteArray *)bytes
              withJavaLangStringBuffer:(JavaLangStringBuffer *)builder {
  ComGoogleProtobufNanoMessageNanoPrinter_appendQuotedBytesWithByteArray_withJavaLangStringBuffer_(bytes, builder);
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "init", "MessageNanoPrinter", NULL, 0x2, NULL, NULL },
    { "printWithComGoogleProtobufNanoMessageNano:", "print", "Ljava.lang.String;", 0x9, NULL, "<T:Lcom/google/protobuf/nano/MessageNano;>(TT;)Ljava/lang/String;" },
    { "printWithNSString:withId:withJavaLangStringBuffer:withJavaLangStringBuffer:", "print", "V", 0xa, "Ljava.lang.IllegalAccessException;Ljava.lang.reflect.InvocationTargetException;", NULL },
    { "deCamelCaseifyWithNSString:", "deCamelCaseify", "Ljava.lang.String;", 0xa, NULL, NULL },
    { "sanitizeStringWithNSString:", "sanitizeString", "Ljava.lang.String;", 0xa, NULL, NULL },
    { "escapeStringWithNSString:", "escapeString", "Ljava.lang.String;", 0xa, NULL, NULL },
    { "appendQuotedBytesWithByteArray:withJavaLangStringBuffer:", "appendQuotedBytes", "V", 0xa, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "INDENT", "INDENT", 0x1a, "Ljava.lang.String;", &ComGoogleProtobufNanoMessageNanoPrinter_INDENT, NULL, .constantValue.asLong = 0 },
    { "MAX_STRING_LEN", "MAX_STRING_LEN", 0x1a, "I", NULL, NULL, .constantValue.asInt = ComGoogleProtobufNanoMessageNanoPrinter_MAX_STRING_LEN },
  };
  static const J2ObjcClassInfo _ComGoogleProtobufNanoMessageNanoPrinter = { 2, "MessageNanoPrinter", "com.google.protobuf.nano", NULL, 0x11, 7, methods, 2, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ComGoogleProtobufNanoMessageNanoPrinter;
}

@end

void ComGoogleProtobufNanoMessageNanoPrinter_init(ComGoogleProtobufNanoMessageNanoPrinter *self) {
  NSObject_init(self);
}

ComGoogleProtobufNanoMessageNanoPrinter *new_ComGoogleProtobufNanoMessageNanoPrinter_init() {
  ComGoogleProtobufNanoMessageNanoPrinter *self = [ComGoogleProtobufNanoMessageNanoPrinter alloc];
  ComGoogleProtobufNanoMessageNanoPrinter_init(self);
  return self;
}

ComGoogleProtobufNanoMessageNanoPrinter *create_ComGoogleProtobufNanoMessageNanoPrinter_init() {
  ComGoogleProtobufNanoMessageNanoPrinter *self = [[ComGoogleProtobufNanoMessageNanoPrinter alloc] autorelease];
  ComGoogleProtobufNanoMessageNanoPrinter_init(self);
  return self;
}

NSString *ComGoogleProtobufNanoMessageNanoPrinter_printWithComGoogleProtobufNanoMessageNano_(ComGoogleProtobufNanoMessageNano *message) {
  ComGoogleProtobufNanoMessageNanoPrinter_initialize();
  if (message == nil) {
    return @"";
  }
  JavaLangStringBuffer *buf = [new_JavaLangStringBuffer_init() autorelease];
  @try {
    ComGoogleProtobufNanoMessageNanoPrinter_printWithNSString_withId_withJavaLangStringBuffer_withJavaLangStringBuffer_(nil, message, [new_JavaLangStringBuffer_init() autorelease], buf);
  }
  @catch (JavaLangIllegalAccessException *e) {
    return JreStrcat("$$", @"Error printing proto: ", [((JavaLangIllegalAccessException *) nil_chk(e)) getMessage]);
  }
  @catch (JavaLangReflectInvocationTargetException *e) {
    return JreStrcat("$$", @"Error printing proto: ", [((JavaLangReflectInvocationTargetException *) nil_chk(e)) getMessage]);
  }
  return [buf description];
}

void ComGoogleProtobufNanoMessageNanoPrinter_printWithNSString_withId_withJavaLangStringBuffer_withJavaLangStringBuffer_(NSString *identifier, id object, JavaLangStringBuffer *indentBuf, JavaLangStringBuffer *buf) {
  ComGoogleProtobufNanoMessageNanoPrinter_initialize();
  if (object == nil) {
  }
  else if ([object isKindOfClass:[ComGoogleProtobufNanoMessageNano class]]) {
    jint origIndentBufLength = [((JavaLangStringBuffer *) nil_chk(indentBuf)) length];
    if (identifier != nil) {
      [((JavaLangStringBuffer *) nil_chk([((JavaLangStringBuffer *) nil_chk([((JavaLangStringBuffer *) nil_chk(buf)) appendWithJavaLangStringBuffer:indentBuf])) appendWithNSString:ComGoogleProtobufNanoMessageNanoPrinter_deCamelCaseifyWithNSString_(identifier)])) appendWithNSString:@" <\n"];
      [indentBuf appendWithNSString:ComGoogleProtobufNanoMessageNanoPrinter_INDENT];
    }
    IOSClass *clazz = [object getClass];
    {
      IOSObjectArray *a__ = [clazz getFields];
      JavaLangReflectField * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
      JavaLangReflectField * const *e__ = b__ + a__->size_;
      while (b__ < e__) {
        JavaLangReflectField *field = *b__++;
        jint modifiers = [((JavaLangReflectField *) nil_chk(field)) getModifiers];
        NSString *fieldName = [field getName];
        if ([@"cachedSize" isEqual:fieldName]) {
          continue;
        }
        if ((modifiers & JavaLangReflectModifier_PUBLIC) == JavaLangReflectModifier_PUBLIC && (modifiers & JavaLangReflectModifier_STATIC) != JavaLangReflectModifier_STATIC && ![((NSString *) nil_chk(fieldName)) hasPrefix:@"_"] && ![fieldName hasSuffix:@"_"]) {
          IOSClass *fieldType = [field getType];
          id value = [field getWithId:object];
          if ([((IOSClass *) nil_chk(fieldType)) isArray]) {
            IOSClass *arrayType = [fieldType getComponentType];
            if (arrayType == [IOSClass byteClass]) {
              ComGoogleProtobufNanoMessageNanoPrinter_printWithNSString_withId_withJavaLangStringBuffer_withJavaLangStringBuffer_(fieldName, value, indentBuf, buf);
            }
            else {
              jint len = value == nil ? 0 : JavaLangReflectArray_getLengthWithId_(value);
              for (jint i = 0; i < len; i++) {
                id elem = JavaLangReflectArray_getWithId_withInt_(value, i);
                ComGoogleProtobufNanoMessageNanoPrinter_printWithNSString_withId_withJavaLangStringBuffer_withJavaLangStringBuffer_(fieldName, elem, indentBuf, buf);
              }
            }
          }
          else {
            ComGoogleProtobufNanoMessageNanoPrinter_printWithNSString_withId_withJavaLangStringBuffer_withJavaLangStringBuffer_(fieldName, value, indentBuf, buf);
          }
        }
      }
    }
    {
      IOSObjectArray *a__ = [clazz getMethods];
      JavaLangReflectMethod * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
      JavaLangReflectMethod * const *e__ = b__ + a__->size_;
      while (b__ < e__) {
        JavaLangReflectMethod *method = *b__++;
        NSString *name = [((JavaLangReflectMethod *) nil_chk(method)) getName];
        if ([((NSString *) nil_chk(name)) hasPrefix:@"set"]) {
          NSString *subfieldName = [name substring:3];
          JavaLangReflectMethod *hazzer = nil;
          @try {
            hazzer = [clazz getMethod:JreStrcat("$$", @"has", subfieldName) parameterTypes:[IOSObjectArray arrayWithLength:0 type:IOSClass_class_()]];
          }
          @catch (JavaLangNoSuchMethodException *e) {
            continue;
          }
          if (![((JavaLangBoolean *) nil_chk((JavaLangBoolean *) cast_chk([((JavaLangReflectMethod *) nil_chk(hazzer)) invokeWithId:object withNSObjectArray:[IOSObjectArray arrayWithLength:0 type:NSObject_class_()]], [JavaLangBoolean class]))) booleanValue]) {
            continue;
          }
          JavaLangReflectMethod *getter = nil;
          @try {
            getter = [clazz getMethod:JreStrcat("$$", @"get", subfieldName) parameterTypes:[IOSObjectArray arrayWithLength:0 type:IOSClass_class_()]];
          }
          @catch (JavaLangNoSuchMethodException *e) {
            continue;
          }
          ComGoogleProtobufNanoMessageNanoPrinter_printWithNSString_withId_withJavaLangStringBuffer_withJavaLangStringBuffer_(subfieldName, [((JavaLangReflectMethod *) nil_chk(getter)) invokeWithId:object withNSObjectArray:[IOSObjectArray arrayWithLength:0 type:NSObject_class_()]], indentBuf, buf);
        }
      }
    }
    if (identifier != nil) {
      [indentBuf setLengthWithInt:origIndentBufLength];
      [((JavaLangStringBuffer *) nil_chk([((JavaLangStringBuffer *) nil_chk(buf)) appendWithJavaLangStringBuffer:indentBuf])) appendWithNSString:@">\n"];
    }
  }
  else if ([JavaUtilMap_class_() isInstance:object]) {
    id<JavaUtilMap> map = (id<JavaUtilMap>) cast_check(object, JavaUtilMap_class_());
    identifier = ComGoogleProtobufNanoMessageNanoPrinter_deCamelCaseifyWithNSString_(identifier);
    for (id<JavaUtilMap_Entry> __strong entry_ in nil_chk([map entrySet])) {
      [((JavaLangStringBuffer *) nil_chk([((JavaLangStringBuffer *) nil_chk([((JavaLangStringBuffer *) nil_chk(buf)) appendWithJavaLangStringBuffer:indentBuf])) appendWithNSString:identifier])) appendWithNSString:@" <\n"];
      jint origIndentBufLength = [((JavaLangStringBuffer *) nil_chk(indentBuf)) length];
      [indentBuf appendWithNSString:ComGoogleProtobufNanoMessageNanoPrinter_INDENT];
      ComGoogleProtobufNanoMessageNanoPrinter_printWithNSString_withId_withJavaLangStringBuffer_withJavaLangStringBuffer_(@"key", [((id<JavaUtilMap_Entry>) nil_chk(entry_)) getKey], indentBuf, buf);
      ComGoogleProtobufNanoMessageNanoPrinter_printWithNSString_withId_withJavaLangStringBuffer_withJavaLangStringBuffer_(@"value", [entry_ getValue], indentBuf, buf);
      [indentBuf setLengthWithInt:origIndentBufLength];
      [((JavaLangStringBuffer *) nil_chk([buf appendWithJavaLangStringBuffer:indentBuf])) appendWithNSString:@">\n"];
    }
  }
  else {
    identifier = ComGoogleProtobufNanoMessageNanoPrinter_deCamelCaseifyWithNSString_(identifier);
    [((JavaLangStringBuffer *) nil_chk([((JavaLangStringBuffer *) nil_chk([((JavaLangStringBuffer *) nil_chk(buf)) appendWithJavaLangStringBuffer:indentBuf])) appendWithNSString:identifier])) appendWithNSString:@": "];
    if ([object isKindOfClass:[NSString class]]) {
      NSString *stringMessage = ComGoogleProtobufNanoMessageNanoPrinter_sanitizeStringWithNSString_((NSString *) cast_chk(object, [NSString class]));
      [((JavaLangStringBuffer *) nil_chk([((JavaLangStringBuffer *) nil_chk([buf appendWithNSString:@"\""])) appendWithNSString:stringMessage])) appendWithNSString:@"\""];
    }
    else if ([object isKindOfClass:[IOSByteArray class]]) {
      ComGoogleProtobufNanoMessageNanoPrinter_appendQuotedBytesWithByteArray_withJavaLangStringBuffer_((IOSByteArray *) cast_chk(object, [IOSByteArray class]), buf);
    }
    else {
      [buf appendWithId:object];
    }
    [buf appendWithNSString:@"\n"];
  }
}

NSString *ComGoogleProtobufNanoMessageNanoPrinter_deCamelCaseifyWithNSString_(NSString *identifier) {
  ComGoogleProtobufNanoMessageNanoPrinter_initialize();
  JavaLangStringBuffer *out = [new_JavaLangStringBuffer_init() autorelease];
  for (jint i = 0; i < ((jint) [((NSString *) nil_chk(identifier)) length]); i++) {
    jchar currentChar = [identifier charAtWithInt:i];
    if (i == 0) {
      [out appendWithChar:JavaLangCharacter_toLowerCaseWithChar_(currentChar)];
    }
    else if (JavaLangCharacter_isUpperCaseWithChar_(currentChar)) {
      [((JavaLangStringBuffer *) nil_chk([out appendWithChar:'_'])) appendWithChar:JavaLangCharacter_toLowerCaseWithChar_(currentChar)];
    }
    else {
      [out appendWithChar:currentChar];
    }
  }
  return [out description];
}

NSString *ComGoogleProtobufNanoMessageNanoPrinter_sanitizeStringWithNSString_(NSString *str) {
  ComGoogleProtobufNanoMessageNanoPrinter_initialize();
  if (![((NSString *) nil_chk(str)) hasPrefix:@"http"] && ((jint) [str length]) > ComGoogleProtobufNanoMessageNanoPrinter_MAX_STRING_LEN) {
    str = JreStrcat("$$", [str substring:0 endIndex:ComGoogleProtobufNanoMessageNanoPrinter_MAX_STRING_LEN], @"[...]");
  }
  return ComGoogleProtobufNanoMessageNanoPrinter_escapeStringWithNSString_(str);
}

NSString *ComGoogleProtobufNanoMessageNanoPrinter_escapeStringWithNSString_(NSString *str) {
  ComGoogleProtobufNanoMessageNanoPrinter_initialize();
  jint strLen = ((jint) [((NSString *) nil_chk(str)) length]);
  JavaLangStringBuilder *b = [new_JavaLangStringBuilder_initWithInt_(strLen) autorelease];
  for (jint i = 0; i < strLen; i++) {
    jchar original = [str charAtWithInt:i];
    if (original >= ' ' && original <= '~' && original != '"' && original != '\'') {
      [b appendWithChar:original];
    }
    else {
      [b appendWithNSString:NSString_formatWithNSString_withNSObjectArray_(@"\\u%04x", [IOSObjectArray arrayWithObjects:(id[]){ JavaLangInteger_valueOfWithInt_((jint) original) } count:1 type:NSObject_class_()])];
    }
  }
  return [b description];
}

void ComGoogleProtobufNanoMessageNanoPrinter_appendQuotedBytesWithByteArray_withJavaLangStringBuffer_(IOSByteArray *bytes, JavaLangStringBuffer *builder) {
  ComGoogleProtobufNanoMessageNanoPrinter_initialize();
  if (bytes == nil) {
    [((JavaLangStringBuffer *) nil_chk(builder)) appendWithNSString:@"\"\""];
    return;
  }
  [((JavaLangStringBuffer *) nil_chk(builder)) appendWithChar:'"'];
  for (jint i = 0; i < ((IOSByteArray *) nil_chk(bytes))->size_; ++i) {
    jint ch = IOSByteArray_Get(bytes, i) & (jint) 0xff;
    if (ch == '\\' || ch == '"') {
      [((JavaLangStringBuffer *) nil_chk([builder appendWithChar:'\\'])) appendWithChar:(jchar) ch];
    }
    else if (ch >= 32 && ch < 127) {
      [builder appendWithChar:(jchar) ch];
    }
    else {
      [builder appendWithNSString:NSString_formatWithNSString_withNSObjectArray_(@"\\%03o", [IOSObjectArray arrayWithObjects:(id[]){ JavaLangInteger_valueOfWithInt_(ch) } count:1 type:NSObject_class_()])];
    }
  }
  [builder appendWithChar:'"'];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComGoogleProtobufNanoMessageNanoPrinter)
